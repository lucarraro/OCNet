<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="OCNet">
<title>An introduction to OCNet • OCNet</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.2.2/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.2.2/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="An introduction to OCNet">
<meta property="og:description" content="OCNet">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">OCNet</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.5.1.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="active nav-item">
  <a class="nav-link" href="../articles/OCNet.html">Get started</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="nav-item">
  <a class="nav-link" href="../news/index.html">Changelog</a>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>An introduction to OCNet</h1>
                        <h4 data-toc-skip class="author">Luca Carraro,
Florian Altermatt, Emanuel A. Fronhofer, Reinhard Furrer, Isabelle
Gounand, Andrea Rinaldo, Enrico Bertuzzo</h4>
            
            <h4 data-toc-skip class="date">November 06, 2019</h4>
      
      
      <div class="d-none name"><code>OCNet.Rmd</code></div>
    </div>

    
    
<pre><code><span><span class="co">#&gt; Warning in rgl.init(initValue, onlyNULL): RGL: unable to open X11 display</span></span>
<span><span class="co">#&gt; Warning: 'rgl.init' failed, running with 'rgl.useNULL = TRUE'.</span></span></code></pre>
<p><strong>Graphical abstract</strong></p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">OCN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_OCN.html">create_OCN</a></span><span class="op">(</span><span class="fl">30</span>, <span class="fl">20</span>, outletPos <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">OCN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_OCN.html">aggregate_OCN</a></span><span class="op">(</span><span class="fu"><a href="../reference/landscape_OCN.html">landscape_OCN</a></span><span class="op">(</span><span class="va">OCN</span><span class="op">)</span>, thrA <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">3</span><span class="op">)</span>, mai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">OCN</span>, thrADraw <span class="op">=</span> <span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Optimal Channel Network"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_elev3D_OCN.html">draw_elev3D_OCN</a></span><span class="op">(</span><span class="va">OCN</span>, drawRiver <span class="op">=</span> <span class="cn">FALSE</span>, addColorbar <span class="op">=</span> <span class="cn">FALSE</span>, expand <span class="op">=</span> <span class="fl">0.2</span>, theta <span class="op">=</span> <span class="op">-</span><span class="fl">30</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Elevation"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="va">OCN</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">streamOrder</span>, <span class="va">OCN</span>, discreteLevels <span class="op">=</span> <span class="cn">TRUE</span>, colPalette <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Strahler stream order"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-1-1.png" width="672"></p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>OCNet enables the creation and analysis of Optimal Channel Networks
(OCNs). These are oriented spanning trees (built on rectangular lattices
made up of square pixels) that reproduce all scaling features
characteristic of real, natural river networks <span class="citation">(Rodriguez-Iturbe et al. 1992; Rinaldo et al.
2014)</span>. As such, they can be used in a variety of numerical and
laboratory experiments in the fields of hydrology, ecology and
epidemiology. Notable examples include studies on metapopulations and
metacommunities <span class="citation">(e.g. Carrara et al.
2012)</span>, scenarios of waterborne pathogen invasions <span class="citation">(e.g. Gatto et al. 2013)</span> and biogeochemichal
processes in streams <span class="citation">(e.g. Helton, Hall, and
Bertuzzo 2018)</span>.</p>
<p>OCNs are obtained by minimization of a functional which represents
total energy dissipated by water flowing through the network spanning
the lattice. Such a formulation embeds the evidence that morphological
and hydrological characteristics of rivers (in particular, water
discharge and slope) follow a power-law scaling with drainage area. For
an overview of the functionalities of the package, see <span class="citation">Carraro et al. (2020)</span>. For details on the
theoretical foundation of the OCN concept, see <span class="citation">Rinaldo et al. (2014)</span>.</p>
<hr>
</div>
<div class="section level2">
<h2 id="some-useful-definitions">Some useful definitions<a class="anchor" aria-label="anchor" href="#some-useful-definitions"></a>
</h2>
<p>In graph theory, an oriented spanning tree is a subgraph of a graph
<span class="math inline">\(G\)</span> such that:</p>
<ul>
<li>it is <em>oriented</em>: edges’ directions are assigned and none of
its pairs of nodes is linked by two symmetric edges;</li>
<li>it is <em>spanning</em>: it contains all nodes of <span class="math inline">\(G\)</span>;</li>
<li>it is a <em>tree</em>: it is weakly connected (there exists a path
between any pair of nodes, if edges’ directions are neglected) and
acyclic (no loops are present).</li>
</ul>
<p>At the simplest aggregation level (flow direction - FD; see Section
@ref(sec:agg) below), OCNs are oriented spanning trees whose nodes are
the pixels consituting the lattice and whose edges represent flow
directions.</p>
<p>Moreover, OCNs, just like real rivers, are constituted of nodes whose
<em>indegree</em> (i.e. the number of edges pointing towards a node) can
assume any value while the <em>outdegree</em> (number of edges exiting
from the node) is equal to 1, except for the <em>root</em> (or
<em>outlet</em> node), whose outdegree is equal to 0. Nodes with null
indegree are termed <em>sources</em>. Nodes with indegree larger than 1
are <em>confluences</em>.</p>
<p>OCNet also allows building multiple networks within a single lattice.
Each of these networks is defined by its respective outlet, which
represents the root of a subgraph; the union of all subgraphs contains
all elements of <span class="math inline">\(G\)</span>. For simplicity,
we will still refer to “OCNs” with regards to these multiple-outlet
entities. In this case, strictly speaking, OCNs are not trees but rather
<em>forests</em>.</p>
<p>An OCN is defined by an <em>adjacency matrix</em> <span class="math inline">\(\mathbf{W}\)</span> with entries <span class="math inline">\(w_{ij}\)</span> equal to 1 if node <span class="math inline">\(i\)</span> drains into <span class="math inline">\(j\)</span> and null otherwise. Owing to the
previously described properties, all rows of <span class="math inline">\(\mathbf{W}\)</span> have a single non-zero entry,
except those identifying the outlet nodes, whose entries are all null.
Each adjacency matrix uniquely defines a vector of <em>contributing
areas</em> (or <em>drainage areas</em>) <span class="math inline">\(\mathbf{A}\)</span>, whose components <span class="math inline">\(A_i\)</span> are equal to the number of nodes
upstream of node <span class="math inline">\(i\)</span> plus the node
itself. Mathematically, this can be expressed as <span class="math inline">\((\mathbf{I}-\mathbf{W}^T)\mathbf{A}=\mathbf{1}\)</span>,
where <span class="math inline">\(\mathbf{I}\)</span> is the identity
matrix and <span class="math inline">\(\mathbf{1}\)</span> a vector of
ones.</p>
<hr>
</div>
<div class="section level2">
<h2 id="ocnet-functions-dependency-tree">OCNet functions dependency tree<a class="anchor" aria-label="anchor" href="#ocnet-functions-dependency-tree"></a>
</h2>
<p>The generation of an OCN is performed by function
<code>create_OCN</code>. Its only required inputs are the dimensions of
the rectangular lattice, but several other features can be implemented
via its optional inputs (see the function documentation for details).
The output of <code>create_OCN</code> is a list, which can be used as
input to the subsequent function <code>landscape_OCN</code>, as shown by
the dependency tree below (indentation of an item implies dependency on
the function at the above level).</p>
<ul>
<li>
<code>create_OCN</code>: performs the OCN search algorithm
<ul>
<li>
<code>landscape_OCN</code>: calculates the elevation field generated
by the OCN
<ul>
<li>
<code>aggregate_OCN</code>: aggregates the OCN at various levels
<ul>
<li>
<code>draw_thematic_OCN</code>: draws OCN with colors of nodes
depending on a theme</li>
<li>
<code>draw_subcatchments_OCN</code>: draws partition of the lattice
into subcatchments as a result of the aggregation process of the
OCN</li>
<li>
<code>paths_OCN</code>: calculates paths and path lengths among OCN
nodes</li>
<li>
<code>rivergeometry_OCN</code>: evaluates hydraulic properties of
the OCN</li>
<li>
<code>OCN_to_igraph</code>: transforms the OCN into an igraph
object</li>
<li>
<code>OCN_to_SSN</code>: transforms the OCN into a
SpatialStreamNetwork object</li>
</ul>
</li>
<li>
<code>draw_contour_OCN</code>: draws “real-shaped”<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;If the OCN was generated with option
&lt;code&gt;periodicBoundaries = FALSE&lt;/code&gt;, the real-shaped representation
of the OCN is equal to the simple, within-lattice representation
provided by &lt;code&gt;draw_simple_OCN&lt;/code&gt;. If the OCN was generated with
&lt;code&gt;periodicBoundaries = TRUE&lt;/code&gt;, its real-shaped representation
is such that, starting from the outlet(s), the position of a FD node
&lt;code&gt;i&lt;/code&gt; is flipped with respect to a lattice side if the edge
between &lt;code&gt;i&lt;/code&gt; and the pixel downstream of &lt;code&gt;i&lt;/code&gt;
crosses such lattice side.&lt;/p&gt;"><sup>1</sup></a> OCNs and catchment
contours</li>
<li>
<code>draw_elev2D_OCN</code>: draws 2D elevation field</li>
<li>
<code>draw_elev3D_OCN</code>: draws 3D elevation field</li>
<li>
<code>draw_elev3Drgl_OCN</code>: draws 3D elevation field (via
<code>rgl</code> rendering system)</li>
<li>
<code>find_area_threshold_OCN</code>: finds relationship between
threshold area and number of nodes at the RN and AG level (see Figure
@ref(fig:ex-net) for relevant definitions)</li>
</ul>
</li>
<li>
<code>draw_simple_OCN</code>: fast drawing of OCNs</li>
</ul>
</li>
<li>
<code>create_peano</code>: creates Peano networks</li>
</ul>
<p>OCNet functions are intended to be applied in sequential order: for
each non-drawing function, the input list is copied into the output
list, to which new sublists and objects are added.</p>
<hr>
</div>
<div class="section level2">
<h2 id="sec:agg">Aggregation levels<a class="anchor" aria-label="anchor" href="#sec:agg"></a>
</h2>
<p>Adjacency matrices and contributing area vectors of an OCN can be
defined at different aggregation levels. In the output of OCNet
functions, variables characterizing the OCN at the different aggregation
levels are grouped within separate sublists, each of them identified by
a two-letter acronym (marked in bold in the list below). Figure
@ref(fig:ex-net) provides a graphical visualization of the
correspondence among the main aggregation levels.</p>
<ol start="0" style="list-style-type: decimal">
<li>
<em>Nearest neighbours</em> (<strong>N4</strong>,
<strong>N8</strong>). Every pixel of the lattice constitutes a node of
the network. Each node is connected to its four (pixels that share an
edge) or eight (pixels that share an edge or a vertex) nearest
neighbours. At this level, <span class="math inline">\(\mathbf{W}\)</span> is defined but <span class="math inline">\(\mathbf{A}\)</span> is not. Note that this level
does not describe flow connectivity, but rather proximity among pixels.
Hence, <span class="math inline">\(\mathbf{W}\)</span> does not describe
an oriented spanning tree.</li>
<li>
<em>Flow direction</em> (<strong>FD</strong>). At this level, every
pixel of the lattice is a node, but connectivity follows the flow
directions that have been found by the OCN search algorithm (operated by
function <code>create_OCN</code>). Edges’ lengths are equal to either
<code>cellsize</code> (the size of a pixel side, optional input in
<code>create_OCN</code>) or <code>cellsize*sqrt(2)</code>, depending on
whether flow direction is horizontal/vertical or diagonal.</li>
<li>
<em>River network</em> (<strong>RN</strong>). The set of nodes at
this level is a subset of the nodes at the FD level, such that their
contributing area is larger than a certain threshold (optional input
<code>A_thr</code> in <code>aggregate_OCN</code>). Such a procedure is
customary in the hydrological problem of extracting a river network
based on digital elevation models of the terrain <span class="citation">(O’Callaghan and Mark 1984)</span>, and corresponds to
the geomorphological concept of erosion threshold <span class="citation">(associated to a threshold in landscape-forming runoff,
of which drainage area represents a proxy Rodriguez-Iturbe and Rinaldo
2001)</span>. Edges’ lengths are again equal to either
<code>cellsize</code> or <code>cellsize*sqrt(2)</code>.</li>
<li>
<em>Aggregated</em> (or <em>reach</em> - <strong>AG</strong>). The
set of nodes at this level is a subset of the nodes at the RN level (see
details in the next section). Accordingly, vector <span class="math inline">\(\mathbf{A}\)</span> is a subset of the vector of
the same name defined at the RN level. Edges can span several pixels and
therefore have various lengths.<br>
</li>
<li>
<em>Subcatchment</em> (<strong>SC</strong>). The number of nodes at
this level is generally<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This might not be the case when there are many outlets.
If the area drained by one of these outlets is lower than the threshold
imposed, the cluster of pixels drained by that outlet constitutes a node
at the SC level that does not have a correspondence at the AG level.&lt;/p&gt;"><sup>2</sup></a> equal to that at the AG level. Each node is
constituted by the cluster of pixels that directly drain into the edge
departing from the corresponding node at the AG level. Here <span class="math inline">\(\mathbf{W}\)</span> does not represent flow
connectivity but rather identifies terrestrial borders among
subcatchments and is therefore symmetric.</li>
<li>
<em>Catchment</em> (<strong>CM</strong>). In this level, the number
of nodes is equal to the number of outlets. Every node represents the
portion of the lattice drained by its relative outlet. <span class="math inline">\(\mathbf{A}\)</span> stores drainage area values
for each of these catchments, while <span class="math inline">\(\mathbf{W}\)</span> identifies terrestrial borders
among catchments.</li>
</ol>
<div class="figure">
<img src="example_networks.png" alt="Representation of the different aggregation levels at which the network is defined (excluding the null levels N4 and N8). The example is obtained from a single-outlet 8x8 lattice. Letter 'O' identifies the outlet pixel. Arrows on the other pixels identify flow directions. Numbers represent the cumulative drainage area (in number of pixels). At the FD level, all 64 pixels belong to the network^[Note that this pattern of flow directions was not derived by an OCN search algortihm, but rather drawn manually for illustration purposes.]. To obtain the RN level, a threshold value of 5 on drainage area is applied to distinguish pixels belonging to the river network. The network at the AG level consists of 9 nodes. The SC level is obtained by splitting the lattice into portions whose pixels drain into the AG nodes and edges. In this example, because there is only one outlet, all pixels belong to a single node at the CM level." width="70%"><p class="caption">
Representation of the different aggregation levels at which the network
is defined (excluding the null levels N4 and N8). The example is
obtained from a single-outlet 8x8 lattice. Letter ‘O’ identifies the
outlet pixel. Arrows on the other pixels identify flow directions.
Numbers represent the cumulative drainage area (in number of pixels). At
the FD level, all 64 pixels belong to the network<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;Note that this pattern of flow directions was not
derived by an OCN search algortihm, but rather drawn manually for
illustration purposes.&lt;/p&gt;"><sup>3</sup></a>. To obtain the RN
level, a threshold value of 5 on drainage area is applied to distinguish
pixels belonging to the river network. The network at the AG level
consists of 9 nodes. The SC level is obtained by splitting the lattice
into portions whose pixels drain into the AG nodes and edges. In this
example, because there is only one outlet, all pixels belong to a single
node at the CM level.
</p>
</div>
<div class="section level3">
<h3 id="relationship-between-nodes-at-the-rn-and-ag-levels">Relationship between nodes at the RN and AG levels<a class="anchor" aria-label="anchor" href="#relationship-between-nodes-at-the-rn-and-ag-levels"></a>
</h3>
<!-- 8 of them correspond to the pixels that represent the channel heads, namely the nodes at RN level with either null indegree (sources) or indegree $> 1$ (confluences), the ninth represents the outlet node (black circle in the bottom-left panel). All nodes except the outlet node have edges departing from them. -->
<p>Nodes at the AG level correspond to a subset of nodes at the RN
level. In particular, nodes at the AG level belong to at least one of
these four categories:</p>
<ul>
<li>
<em>Sources</em>: nodes at the RN level with null indegree.</li>
<li>
<em>Confluences</em>: nodes at the RN level with indegree larger
than one.</li>
<li>
<em>Outlets</em>: corresponding to outlets at the RN level.</li>
<li>
<em>Breaking nodes</em> (only if <code>maxReachLength</code> is
finite): nodes that split edges that are longer than
<code>maxReachLength</code>.</li>
</ul>
<p>Outlet nodes at the AG level might also be sources, confluences or
breaking nodes. All AG nodes except outlet nodes have outdegree equal to
1. All RN nodes that do not correspond to AG nodes constitute the edges
of the network at the AG level: more specifically, each edge is formed
by an AG node and a sequence of RN nodes downstream of the AG node,
until another AG node is found.</p>
<p>Figure @ref(fig:ex3-net) shows an alternative aggregation scheme for
the network showed in Figure @ref(fig:ex-net) when the optional input
<code>maxReachLength</code> is set to a finite value.</p>
<div class="figure">
<img src="example_networks3.png" alt="Aggregation of the previous network with `A_thr` equal to 5 pixels and `maxReachLength` equal to 3 pixel sides. Note that the length of the diagonal segments of the edges is equal to `sqrt(2)`." width="70%"><p class="caption">
Aggregation of the previous network with <code>A_thr</code> equal to 5
pixels and <code>maxReachLength</code> equal to 3 pixel sides. Note that
the length of the diagonal segments of the edges is equal to
<code>sqrt(2)</code>.
</p>
</div>
</div>
<div class="section level3">
<h3 id="correspondence-between-indices-at-different-levels">Correspondence between indices at different levels<a class="anchor" aria-label="anchor" href="#correspondence-between-indices-at-different-levels"></a>
</h3>
<p>The output of <code>aggregate_OCN</code> contains objects named
<code>OCN$XX$toYY</code>, where <code>XX</code> and <code>YY</code> are
two different aggregation levels. These objects define the
correspondences between indices among aggregation levels.
<code>OCN$XX$toYY</code> contains a number of elements equal to the
number of nodes at <code>XX</code> level; each element
<code>OCN$XX$toYY[[i]]</code> contains the index/indices at
<code>YY</code> level corresponding to node <code>i</code> at
<code>XX</code> level. For aggregation level AG, additional
correspondence objects are marked by the string <code>Reach</code>:
these consider the whole sequence of RN nodes constituting the edge
departing from an AG node as belonging to the AG node.</p>
<p>The example shown in Figure @ref(fig:ex-ind) corresponds to the
dataset <code>OCN_4</code> included in the package. Note that index
numbering starts from the lower-left (southwestern) corner of the
lattice.</p>
<div class="figure">
<img src="indices_example.png" alt="Top-left panel: arrows display flow directions, numbers identify contributing areas. Bottom-left panel: the network is aggregated by imposing a threshold equal to 2 pixels. The other panels display indices of nodes at the different aggregation levels. " width="90%"><p class="caption">
Top-left panel: arrows display flow directions, numbers identify
contributing areas. Bottom-left panel: the network is aggregated by
imposing a threshold equal to 2 pixels. The other panels display indices
of nodes at the different aggregation levels.
</p>
</div>
<p>The R code below displays the different <code>OCN$XX$toYY</code>
objects corresponding to the example in Figure @ref(fig:ex-ind):</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ex</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_OCN.html">aggregate_OCN</a></span><span class="op">(</span><span class="fu"><a href="../reference/landscape_OCN.html">landscape_OCN</a></span><span class="op">(</span><span class="va">OCN_4</span><span class="op">)</span>, thrA <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">FD</span><span class="op">$</span><span class="va">toRN</span></span>
<span><span class="co">#&gt;  [1] 1 2 3 0 4 0 0 5 6 7 0 0 0 0 8 0</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">FD</span><span class="op">$</span><span class="va">toSC</span></span>
<span><span class="co">#&gt;  [1] 1 3 3 3 2 3 3 3 4 5 5 3 4 5 5 5</span></span>
<span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">toFD</span></span>
<span><span class="co">#&gt; [1]  1  2  3  5  8  9 10 15</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">toAG</span></span>
<span><span class="co">#&gt; [1] 1 0 0 2 3 4 0 5</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">toAGReach</span></span>
<span><span class="co">#&gt; [1] 1 3 3 2 3 4 5 5</span></span>
<span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">toFD</span></span>
<span><span class="co">#&gt; [1]  1  5  8  9 15</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">ReachToFD</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 2 3 8</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 9</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 10 15</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">toRN</span></span>
<span><span class="co">#&gt; [1] 1 4 5 6 8</span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">ReachToRN</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 4</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1] 2 3 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1] 6</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 7 8</span></span>
<span></span>
<span><span class="va">ex</span><span class="op">$</span><span class="va">SC</span><span class="op">$</span><span class="va">toFD</span></span>
<span><span class="co">#&gt; [[1]]</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[2]]</span></span>
<span><span class="co">#&gt; [1] 5</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[3]]</span></span>
<span><span class="co">#&gt; [1]  2  3  8  4  6  7 12</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[4]]</span></span>
<span><span class="co">#&gt; [1]  9 13</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; [[5]]</span></span>
<span><span class="co">#&gt; [1] 10 15 11 14 16</span></span></code></pre></div>
<hr>
</div>
</div>
<div class="section level2">
<h2 id="a-working-example">A working example<a class="anchor" aria-label="anchor" href="#a-working-example"></a>
</h2>
<p>Let’s build an OCN on a 20x20 lattice and assume that each cell
represents a square of side 500 m. The total size of the catchment is
therefore 100 km<sup>2</sup>. Let’s locate the outlet close to the
southwestern corner of the lattice. Function
<code>draw_simple_OCN</code> can then be used to display the OCN.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">OCNwe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_OCN.html">create_OCN</a></span><span class="op">(</span><span class="fl">20</span>, <span class="fl">20</span>, outletPos <span class="op">=</span> <span class="fl">3</span>, cellsize <span class="op">=</span> <span class="fl">500</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-3-1.png" width="384"></p>
<p>Now, let’s construct the elevation field subsumed by the OCN. Let’s
suppose that the outlet has null elevation and slope equal to 0.01.
Then, we use <code>draw_elev3D_OCN</code> to draw the three-dimensional
elevation map (values are in m).</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OCNwe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/landscape_OCN.html">landscape_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span>, slope0 <span class="op">=</span> <span class="fl">0.01</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_elev3D_OCN.html">draw_elev3D_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span>, drawRiver <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-4-1.png" width="672"></p>
<p>Next, the OCN can be aggregated. Let’s suppose that the desired
number of nodes at the AG level be as close as possible<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;It is not guaranteed that an OCN can be aggregated to an
arbitrary number of nodes. This is due to the fact that the indegree of
confluence nodes is typically 2 or 3, depending on the flow direction
patterns. For example, if the outlet is not a confluence node, all
confluence nodes have indegree equal to 2, and
&lt;code&gt;maxReachLength = Inf&lt;/code&gt;, then the resulting number of
aggregated nodes will be even.&lt;/p&gt;"><sup>4</sup></a> to 20. With function
<code>find_area_threshold_OCN</code> we can derive the corresponding
value of drainage area threshold:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">thr</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_area_threshold_OCN.html">find_area_threshold_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">)</span></span>
<span><span class="co"># find index corresponding to thr$Nnodes ~= 20</span></span>
<span><span class="va">indThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">thr</span><span class="op">$</span><span class="va">nNodesAG</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span> <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">min</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/MathFun.html" class="external-link">abs</a></span><span class="op">(</span><span class="va">thr</span><span class="op">$</span><span class="va">nNodesAG</span> <span class="op">-</span> <span class="fl">20</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">indThr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">indThr</span><span class="op">)</span> <span class="co"># pick the last ind_thr that satisfies the condition above</span></span>
<span><span class="va">thrA20</span> <span class="op">&lt;-</span> <span class="va">thr</span><span class="op">$</span><span class="va">thrValues</span><span class="op">[</span><span class="va">indThr</span><span class="op">]</span> <span class="co"># corresponding threshold area</span></span></code></pre></div>
<p>The resulting number of nodes is<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;The number of aggregated nodes is here uneven because
one node has indegree equal to 3 (see figure below).&lt;/p&gt;"><sup>5</sup></a> 20, corresponding to a threshold area
<code>thrA20 =</code> 2.5 km<sup>2</sup>. The latter value can now be
used in function <code>aggregate_OCN</code> to obtain the aggregated
network. Function <code>draw_subcatchments_OCN</code> shows how the
lattice is partitioned into subcatchments. It is possible to add points
at the locations of the nodes at the AG level.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OCNwe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/aggregate_OCN.html">aggregate_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span>, thrA <span class="op">=</span> <span class="va">thrA20</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_subcatchments_OCN.html">draw_subcatchments_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/points.html" class="external-link">points</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">X</span>,<span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">Y</span>, pch <span class="op">=</span> <span class="fl">21</span>, col <span class="op">=</span> <span class="st">"blue"</span>, bg <span class="op">=</span> <span class="st">"blue"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-6-1.png" width="672"></p>
<p>Finally, <code>draw_thematic_OCN</code> can be used to display the
along-stream distances of RN-level nodes to the outlet (in m), as
calculated by <code>paths_OCN</code>.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">OCNwe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/paths_OCN.html">paths_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span>, includePaths <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0</span>,<span class="fl">0.1</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">downstreamPathLength</span><span class="op">[</span> , <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span>, <span class="va">OCNwe</span>, </span>
<span>                  backgroundColor <span class="op">=</span> <span class="st">"#606060"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-7-1.png" width="672"></p>
<div class="section level3">
<h3 id="application-metapopulation-model">Application: metapopulation model<a class="anchor" aria-label="anchor" href="#application-metapopulation-model"></a>
</h3>
<div class="section level4">
<h4 id="theory">Theory<a class="anchor" aria-label="anchor" href="#theory"></a>
</h4>
<p>Let’s build a simple discrete-time, deterministic metapopulation
model on the previously built OCN. In particular, let’s assume that:</p>
<ul>
<li>The expected population growth at node <span class="math inline">\(i\)</span> follows the Beverton-Holt model, with
proliferation rate <span class="math inline">\(r\)</span> and carrying
capacity <span class="math inline">\(K_i\)</span>.</li>
<li>At each timestep, the number of individuals moving from node <span class="math inline">\(i\)</span> is expressed as <span class="math inline">\(G(P_i(t),K_i)\)</span>, where <span class="math inline">\(P_i(t)\)</span> is the (expected) population size
at node <span class="math inline">\(i\)</span> and time <span class="math inline">\(t\)</span>.</li>
<li>
<span class="math inline">\(G(P_i(t),K_i)=G(K_i,K_i)\cdot
P_i(t)/K_i\)</span>, namely the number of individuals moving from node
<span class="math inline">\(i\)</span> increases linearly with <span class="math inline">\(P_i(t)\)</span>.</li>
<li>At each timestep, individuals at node <span class="math inline">\(i\)</span> can only move to a node that is
directly connected to <span class="math inline">\(i\)</span>, either
downstream or upstream.</li>
<li>
<span class="math inline">\(p_d\)</span> and <span class="math inline">\(p_u = 1 - p_d\)</span> identify the probability to
move downstream or upstream, respectively. For a headwater node <span class="math inline">\(i\)</span>, due to the lack of an upstream
connection, the actual (expected) number of individuals moving out of
<span class="math inline">\(i\)</span> at time <span class="math inline">\(t\)</span> is <span class="math inline">\(p_d
G(P_i(t),K_i)\)</span>. Vice versa, the (expected) number of individuals
moving out of the outlet <span class="math inline">\(o\)</span> at time
<span class="math inline">\(t\)</span> is <span class="math inline">\(p_u G(P_o(t),K_o)\)</span>.</li>
<li>If the indegree of a node is larger than one, individuals moving
upstream are split among the possible destination nodes into fractions
<span class="math inline">\(Y\)</span> proportional to their drainage
areas.</li>
</ul>
<p>Therefore, the model equation is: <span class="math display">\[
\begin{split}
P_i(t+1) &amp;= \frac{r P_i(t)}{1+ (r-1)P_i(t)/K_i} - (p_d D_i + p_u
U_i)G(K_i,K_i)\frac{P_i(t)}{K_i} \\
&amp;\quad + p_d \left( \sum_{j=1} w_{ji}
G(K_j,K_j)\frac{P_j(t)}{K_j}\right) + p_u \left( \sum_{j=1} w_{ij} Y_i
G(K_j,K_j)\frac{P_j(t)}{K_j}\right)
\end{split}
\]</span> where <span class="math inline">\(D_i\)</span> (<span class="math inline">\(U_i\)</span>) is equal to one if there is a
downstream (upstream) connection available from node <span class="math inline">\(i\)</span> and is null otherwise. Weights <span class="math inline">\(Y_i\)</span> are defined as: <span class="math display">\[
Y_i = \frac{A_i}{\sum_{k=1} w_{kj}A_k},
\]</span> where <span class="math inline">\(j\)</span> identifies the
node downstream of <span class="math inline">\(i\)</span>. Moreover, it
is <span class="math inline">\(Y_o = 1\)</span>.</p>
<p>At carrying capacity, the system is at equilibrium, which implies
that the (expected) number of individuals moving from a node <span class="math inline">\(i\)</span> to its downstream connection <span class="math inline">\(j\)</span> is equal to the (expected) number of
individuals moving from <span class="math inline">\(j\)</span> to <span class="math inline">\(i\)</span>: <span class="math display">\[
p_d G(K_i,K_i) = p_u Y_i G(K_j,K_j).
\]</span> The iterative application of the above equation allows the
calculation of <span class="math inline">\(G(K_i,K_i)\)</span> for all
<span class="math inline">\(i\)</span> up to a constant. To this end,
let’s assume <span class="math inline">\(G(K_o,K_o) = G_o\)</span>. We
therefore obtain <span class="math display">\[
G(K_i,K_i) = G_o \left(\frac{p_u}{p_d}\right)^{|P_{io}|} \prod_{k \in
P_{io}} Y_k,
\]</span> where <span class="math inline">\(P_{io}\)</span> is the set
of nodes constituting the downstream path from <span class="math inline">\(i\)</span> to the outlet <span class="math inline">\(o\)</span>, while <span class="math inline">\(|P_{io}|\)</span> is its cardinality.</p>
</div>
<div class="section level4">
<h4 id="implementation">Implementation<a class="anchor" aria-label="anchor" href="#implementation"></a>
</h4>
<p>For this example, let’s use the previously derived
<code>OCN_we</code> aggregated at the RN level. Let’s assume that
carrying capacity is proportional to the river width evaluated at the
nodes, while the initial population distribution is randomly
assigned.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Input data</span></span>
<span><span class="va">OCNwe</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/rivergeometry_OCN.html">rivergeometry_OCN</a></span><span class="op">(</span><span class="va">OCNwe</span>, widthMax <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>   <span class="co"># evaluate river width </span></span>
<span><span class="va">K</span> <span class="op">&lt;-</span> <span class="fl">10</span><span class="op">*</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">width</span>                             <span class="co"># calculate carrying capacity </span></span>
<span><span class="va">pop0</span> <span class="op">&lt;-</span> <span class="fl">2</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/mean.html" class="external-link">mean</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/stats/Uniform.html" class="external-link">runif</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span>           <span class="co"># initial random population vector</span></span>
<span><span class="va">nTimestep</span> <span class="op">&lt;-</span> <span class="fl">100</span>                                   <span class="co"># number of timesteps</span></span>
<span><span class="va">r</span> <span class="op">&lt;-</span> <span class="fl">1.05</span>                                          <span class="co"># proliferation rate</span></span>
<span><span class="va">pd</span> <span class="op">&lt;-</span> <span class="fl">0.5</span>                                          <span class="co"># probability to move downstream</span></span>
<span><span class="va">pu</span> <span class="op">&lt;-</span> <span class="fl">1</span> <span class="op">-</span> <span class="va">pd</span>                                       <span class="co"># probability to move upstream</span></span>
<span><span class="va">Go</span> <span class="op">&lt;-</span> <span class="fl">5</span>                                            <span class="co"># parameter controlling mobility </span></span>
<span><span class="co"># (no. individuals exiting from outlet node at carrying capacity is pu*Go) </span></span></code></pre></div>
<p>We can now compute weights <span class="math inline">\(Y\)</span>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Weights for upstream movement</span></span>
<span><span class="va">Y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">1</span>,<span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span>                    </span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">if</span> <span class="op">(</span><span class="va">i</span> <span class="op">!=</span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">Y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">A</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">W</span><span class="op">[</span> , <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">downNode</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">A</span><span class="op">)</span></span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>and <span class="math inline">\(G(K_i,K_i)\)</span>:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Evaluate expected number of individuals moving at carrying capacity</span></span>
<span><span class="va">GKK</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0</span>, <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="va">path</span> <span class="op">&lt;-</span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">downstreamPath</span><span class="op">[[</span><span class="va">i</span><span class="op">]</span><span class="op">]</span><span class="op">[[</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span><span class="op">]</span> <span class="co"># select path</span></span>
<span>  <span class="va">prod</span> <span class="op">&lt;-</span> <span class="va">Go</span>                                                <span class="co"># initialize product of Y </span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">j</span> <span class="kw">in</span> <span class="va">path</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">prod</span> <span class="op">&lt;-</span> <span class="va">prod</span><span class="op">*</span><span class="va">Y</span><span class="op">[</span><span class="va">j</span><span class="op">]</span></span>
<span>  <span class="op">}</span></span>
<span>  <span class="va">GKK</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="op">(</span><span class="va">pu</span><span class="op">/</span><span class="va">pd</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">path</span><span class="op">)</span><span class="op">)</span><span class="op">*</span><span class="va">prod</span>  </span>
<span><span class="op">}</span></span></code></pre></div>
<p>We can now run the metapopulation model:</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">## Run metapopulation model</span></span>
<span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span>data<span class="op">=</span><span class="fl">0</span>,ncol<span class="op">=</span><span class="va">nTimestep</span>,nrow<span class="op">=</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span>  <span class="co"># metapopulation matrix</span></span>
<span><span class="va">pop</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="va">pop0</span>                                              <span class="co"># initialization</span></span>
<span><span class="kw">for</span> <span class="op">(</span><span class="va">t</span> <span class="kw">in</span> <span class="fl">2</span><span class="op">:</span><span class="va">nTimestep</span><span class="op">)</span><span class="op">{</span></span>
<span>  <span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span><span class="op">{</span></span>
<span>    <span class="va">pop</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">]</span> <span class="op">&lt;-</span> </span>
<span>      <span class="co"># Beverton-Holt growth model</span></span>
<span>      <span class="va">r</span><span class="op">*</span><span class="va">pop</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="op">(</span><span class="fl">1</span> <span class="op">+</span> <span class="va">pop</span><span class="op">[</span><span class="va">i</span>, <span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">*</span><span class="op">(</span><span class="va">r</span><span class="op">-</span><span class="fl">1</span><span class="op">)</span><span class="op">/</span><span class="va">K</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="co"># individuals exiting from node i</span></span>
<span>                <span class="op">-</span> <span class="op">(</span><span class="va">pu</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">W</span><span class="op">[</span> , <span class="va">i</span><span class="op">]</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span> <span class="op">+</span> <span class="va">pd</span><span class="op">*</span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">W</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span><span class="op">)</span><span class="op">&gt;</span><span class="fl">0</span><span class="op">)</span><span class="op">)</span> <span class="op">*</span> </span>
<span>      <span class="va">GKK</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="op">(</span><span class="va">pop</span><span class="op">[</span><span class="va">i</span>,<span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">K</span><span class="op">[</span><span class="va">i</span><span class="op">]</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="co"># individuals entering in i from the upstream nodes</span></span>
<span>                <span class="op">+</span> <span class="va">pd</span> <span class="op">*</span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">W</span><span class="op">[</span> , <span class="va">i</span><span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">GKK</span><span class="op">*</span><span class="va">pop</span><span class="op">[</span> , <span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">K</span><span class="op">)</span> <span class="op">+</span></span>
<span>      <span class="co"># individuals entering in i from the downstream node</span></span>
<span>                <span class="op">+</span> <span class="va">pu</span> <span class="op">*</span> <span class="va">Y</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">*</span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">W</span><span class="op">[</span><span class="va">i</span>, <span class="op">]</span> <span class="op"><a href="https://rdrr.io/r/base/matmult.html" class="external-link">%*%</a></span> <span class="op">(</span><span class="va">GKK</span><span class="op">*</span><span class="va">pop</span><span class="op">[</span> , <span class="va">t</span><span class="op">-</span><span class="fl">1</span><span class="op">]</span><span class="op">/</span><span class="va">K</span><span class="op">)</span> </span>
<span>    </span>
<span>  <span class="op">}</span></span>
<span><span class="op">}</span></span></code></pre></div>
<p>The left panel of the graph below shows the time evolution of the
local population at the outlet (red) and at the node at highest distance
from the outlet (blue). In the right panel, the evolution total
metapopulation size is shown. Dashed lines indicate population values at
carrying capacity.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pop</span><span class="op">[</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span>, <span class="op">]</span>, type <span class="op">=</span> <span class="st">"l"</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.05</span><span class="op">*</span><span class="va">K</span><span class="op">[</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>     xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Population"</span>, lwd <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Evolution of local pop. size"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nTimestep</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span>, <span class="va">K</span><span class="op">[</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="va">farthestNode</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">downstreamPathLength</span><span class="op">[</span> , <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span></span>
<span>                      <span class="op">==</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">downstreamPathLength</span><span class="op">[</span> , <span class="va">OCNwe</span><span class="op">$</span><span class="va">RN</span><span class="op">$</span><span class="va">outlet</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pop</span><span class="op">[</span><span class="va">farthestNode</span>, <span class="op">]</span>, type<span class="op">=</span><span class="st">"l"</span>, col<span class="op">=</span><span class="st">"blue"</span>,lwd<span class="op">=</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nTimestep</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">K</span><span class="op">[</span><span class="va">farthestNode</span><span class="op">]</span>, <span class="va">K</span><span class="op">[</span><span class="va">farthestNode</span><span class="op">]</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"blue"</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/colSums.html" class="external-link">colSums</a></span><span class="op">(</span><span class="va">pop</span><span class="op">)</span>, type <span class="op">=</span> <span class="st">"l"</span>, xlab <span class="op">=</span> <span class="st">"Time"</span>, ylab <span class="op">=</span> <span class="st">"Population"</span>, lwd <span class="op">=</span> <span class="fl">2</span>, ylim <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">1.05</span><span class="op">*</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="va">nTimestep</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>,<span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span><span class="op">)</span>, lty <span class="op">=</span> <span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Evolution of metapop. size"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-12-1.png" width="672"></p>
<p>Function <code>draw_thematic_OCN</code> can be used to visualize the
spatial distribution of the metapopulation at given time points.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">2</span><span class="op">)</span>, mai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="va">pop</span><span class="op">[</span>,<span class="fl">1</span><span class="op">]</span>, <span class="va">OCNwe</span>, colLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>                  drawNodes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Time = 1"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="va">pop</span><span class="op">[</span>,<span class="fl">5</span><span class="op">]</span>, <span class="va">OCNwe</span>, colLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>                  drawNodes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Time = 5"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="va">pop</span><span class="op">[</span>,<span class="fl">20</span><span class="op">]</span>, <span class="va">OCNwe</span>, colLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>                  drawNodes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Time = 20"</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="va">pop</span><span class="op">[</span>,<span class="fl">100</span><span class="op">]</span>, <span class="va">OCNwe</span>, colLevels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">max</a></span><span class="op">(</span><span class="va">K</span><span class="op">)</span>, <span class="fl">1000</span><span class="op">)</span>,</span>
<span>                  drawNodes <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Time = 100"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-13-1.png" width="672"></p>
<hr>
</div>
</div>
</div>
<div class="section level2">
<h2 id="peano-networks">Peano networks<a class="anchor" aria-label="anchor" href="#peano-networks"></a>
</h2>
<p>Function <code>create_peano</code> can be used in lieu of
<code>create_OCN</code> to generate Peano networks on square lattices.
Peano networks are deterministic, plane-filling fractals whose
topological measures (Horton’s bifurcation and length ratios) are akin
to those of real river networks <span class="citation">(Marani, Rigon,
and Rinaldo 1991)</span> and can then be used in a variety of synthetic
experiments, as it is the case for OCNs <span class="citation">(e.g.
Campos, Fort, and Méndez 2006)</span>. Peano networks are generated by
means of an iterative algorithm: at each iteration, the size of the
lattice side is doubled (see code below). As a result, Peano networks
span squares of side equal to a power of 2. The outlet must be located
at a corner of the square.</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mfrow <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">2</span>, <span class="fl">3</span><span class="op">)</span>, mai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0.2</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">peano0</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_peano.html">create_peano</a></span><span class="op">(</span><span class="fl">0</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">peano0</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Iteration: 0 - Lattice size: 2x2"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peano1</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_peano.html">create_peano</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">peano1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Iteration: 1 - Lattice size: 4x4"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peano2</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_peano.html">create_peano</a></span><span class="op">(</span><span class="fl">2</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">peano2</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Iteration: 2 - Lattice size: 8x8"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peano3</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_peano.html">create_peano</a></span><span class="op">(</span><span class="fl">3</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">peano3</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Iteration: 3 - Lattice size: 16x16"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peano4</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_peano.html">create_peano</a></span><span class="op">(</span><span class="fl">4</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">peano4</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Iteration: 4 - Lattice size: 32x32"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">peano5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/create_peano.html">create_peano</a></span><span class="op">(</span><span class="fl">5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_simple_OCN.html">draw_simple_OCN</a></span><span class="op">(</span><span class="va">peano5</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Iteration: 5 - Lattice size: 64x64"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-14-1.png" width="672"></p>
<p>The output of <code>create_peano</code> is a list containing the same
objects as those produced by <code>create_OCN</code>. As such, it can be
used as input for all other complementary functions of the package.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span>, <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">peano5</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/landscape_OCN.html">landscape_OCN</a></span><span class="op">(</span><span class="va">peano5</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_elev2D_OCN.html">draw_elev2D_OCN</a></span><span class="op">(</span><span class="va">peano5</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-15-1.png" width="480"></p>
<hr>
</div>
<div class="section level2">
<h2 id="list-of-ready-made-ocns">List of ready-made OCNs<a class="anchor" aria-label="anchor" href="#list-of-ready-made-ocns"></a>
</h2>
<p>OCNet contains some ready-made large OCNs built via function
<code>create_OCN</code>. Their features are summarized in the Table
below. Refer to the documentation of <code>create_OCN</code> for the
definition of column names. Note that:</p>
<ul>
<li>If not specified otherwise, the position of outlet(s) was derived
from default options.</li>
<li>
<strong>Cooling schedule</strong>:
<ul>
<li>
<em>cold</em>: corresponds to <code>coolingRate = 10</code>,
<code>initialNoCoolingPhase = 0</code>;</li>
<li>
<em>default</em>: corresponds to default values
<code>coolingRate = 1</code>,
<code>initialNoCoolingPhase = 0</code>;</li>
<li>
<em>hot</em>: corresponds to <code>coolingRate = 0.5</code>,
<code>initialNoCoolingPhase = 0.1</code>.</li>
</ul>
</li>
<li>
<strong>seed</strong> is the value of the argument used in the call
of <code>set.seed</code> prior to executing
<code>create_OCN</code>.</li>
<li>
<strong>On CRAN?</strong> identifies which OCNs are uploaded in the
version of OCNet that can be downloaded from CRAN (owing to limitation
in package size). Installation of package from <a href="https://github.com/lucarraro/OCNet" class="external-link">GitHub</a> provides the
complete set of OCNs hereafter described<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;At this &lt;a href="https://github.com/lucarraro/OCNetExtendedData" class="external-link"&gt;GitHub link&lt;/a&gt; it
is possible to download the same OCNs generated by adding optional
arguments &lt;code&gt;saveEnergy = TRUE&lt;/code&gt;,
&lt;code&gt;saveExitFlag = TRUE&lt;/code&gt;, which substantially increases the size
of the output of &lt;code&gt;create_OCN&lt;/code&gt;.&lt;/p&gt;'><sup>6</sup></a>.</li>
</ul>
<table class="table">
<colgroup>
<col width="9%">
<col width="6%">
<col width="6%">
<col width="10%">
<col width="18%">
<col width="12%">
<col width="15%">
<col width="8%">
<col width="5%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="right">name</th>
<th align="center">dimX</th>
<th align="center">dimY</th>
<th align="center">No. of outlets</th>
<th align="center">Periodic Boundaries</th>
<th align="center">Initial State</th>
<th align="center">Cooling Schedule</th>
<th align="center">Cellsize</th>
<th align="center">seed</th>
<th align="center">On CRAN?</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">
<code>OCN_4</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This is actually not an OCN, but was rather generated
manually for illustration purposes.&lt;/p&gt;"><sup>7</sup></a>
</td>
<td align="center">4</td>
<td align="center">4</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">1</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td align="right"><code>OCN_20</code></td>
<td align="center">20</td>
<td align="center">20</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">1</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_250</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_250_T</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">T</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_250_V</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">V</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_250_cold</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">cold</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">No</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_250_hot</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">hot</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_250_V_cold</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">V</td>
<td align="center">cold</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">No</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_250_V_hot</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">V</td>
<td align="center">hot</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_250_PB</code></td>
<td align="center">250</td>
<td align="center">250</td>
<td align="center">1</td>
<td align="center">TRUE</td>
<td align="center">I</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">2</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_rect1</code></td>
<td align="center">450</td>
<td align="center">150</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_rect2</code></td>
<td align="center">150</td>
<td align="center">450</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">default</td>
<td align="center">1</td>
<td align="center">3</td>
<td align="center">No</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_300_diag</code></td>
<td align="center">300</td>
<td align="center">300</td>
<td align="center">1<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;&lt;code&gt;outletPos = 1&lt;/code&gt;.&lt;/p&gt;"><sup>8</sup></a>
</td>
<td align="center">FALSE</td>
<td align="center">V</td>
<td align="center">default</td>
<td align="center">50</td>
<td align="center">4</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_300_4out</code></td>
<td align="center">300</td>
<td align="center">300</td>
<td align="center">4<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;outletSide = c("S","N","W","E")&lt;/code&gt;,
&lt;code&gt;outletPos = c(1,300,149,150)&lt;/code&gt;.&lt;/p&gt;'><sup>9</sup></a>
</td>
<td align="center">FALSE</td>
<td align="center">V</td>
<td align="center">default</td>
<td align="center">50</td>
<td align="center">5</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_300_4out_PB_hot</code></td>
<td align="center">300</td>
<td align="center">300</td>
<td align="center">4<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;outletSide = c("S","N","W","E")&lt;/code&gt;,
&lt;code&gt;outletPos = c(1,300,149,150)&lt;/code&gt;.&lt;/p&gt;'><sup>10</sup></a>
</td>
<td align="center">TRUE</td>
<td align="center">V</td>
<td align="center">hot</td>
<td align="center">50</td>
<td align="center">5</td>
<td align="center">Yes</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_300_7out</code></td>
<td align="center">300</td>
<td align="center">300</td>
<td align="center">7</td>
<td align="center">FALSE</td>
<td align="center">V</td>
<td align="center">default</td>
<td align="center">50</td>
<td align="center">5</td>
<td align="center">No</td>
</tr>
<tr class="odd">
<td align="right"><code>OCN_400_T_out</code></td>
<td align="center">400</td>
<td align="center">400</td>
<td align="center">1</td>
<td align="center">FALSE</td>
<td align="center">T</td>
<td align="center">hot</td>
<td align="center">50</td>
<td align="center">7</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_400_Allout</code></td>
<td align="center">400</td>
<td align="center">400</td>
<td align="center">All</td>
<td align="center">FALSE</td>
<td align="center">H</td>
<td align="center">hot</td>
<td align="center">50</td>
<td align="center">8</td>
<td align="center">Yes</td>
</tr>
<tr class="odd">
<td align="right">
<code>OCN_500_hot</code><a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content="&lt;p&gt;This OCN was obtained with
&lt;code&gt;nIter = 50*dimX*dimY&lt;/code&gt;.&lt;/p&gt;"><sup>11</sup></a>
</td>
<td align="center">500</td>
<td align="center">500</td>
<td align="center">1<a class="footnote-ref" tabindex="0" data-bs-toggle="popover" data-bs-content='&lt;p&gt;&lt;code&gt;outletSide = "E", outletPos = 100&lt;/code&gt;&lt;/p&gt;'><sup>12</sup></a>
</td>
<td align="center">FALSE</td>
<td align="center">I</td>
<td align="center">hot</td>
<td align="center">50</td>
<td align="center">9</td>
<td align="center">No</td>
</tr>
<tr class="even">
<td align="right"><code>OCN_500_PB_hot</code></td>
<td align="center">500</td>
<td align="center">500</td>
<td align="center">1</td>
<td align="center">TRUE</td>
<td align="center">V</td>
<td align="center">hot</td>
<td align="center">50</td>
<td align="center">10</td>
<td align="center">No</td>
</tr>
</tbody>
</table>
<hr>
</div>
<div class="section level2">
<h2 id="compatibility-with-other-packages">Compatibility with other packages<a class="anchor" aria-label="anchor" href="#compatibility-with-other-packages"></a>
</h2>
<div class="section level3">
<h3 id="igraph">igraph<a class="anchor" aria-label="anchor" href="#igraph"></a>
</h3>
<p>Adjacency matrices at all aggregation levels are produced as
<code>spam</code> <span class="citation">(Furrer and Sain 2010)</span>
objects. In order to transform the OCN into an <code>igraph</code> <span class="citation">(Csardi and Nepusz 2006)</span> graph object, the
adjacency matrix must be converted into a <code>Matrix</code> object
(via function <code>as.dgCMatrix.spam</code> of <code>spam</code>).
Function <code>graph_from_adjacency_matrix</code> of <code>igraph</code>
can then be used to obtain a graph object.</p>
<p>For example, let’s transform the previously obtained
<code>OCN_we</code> at the AG level into a graph:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span>,<span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/OCN_to_igraph.html">OCN_to_igraph</a></span><span class="op">(</span><span class="va">OCNwe</span>, level <span class="op">=</span> <span class="st">"AG"</span><span class="op">)</span></span>
<span><span class="fu">plot.igraph</span><span class="op">(</span><span class="va">g</span>, vertex.color <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/grDevices/palettes.html" class="external-link">rainbow</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span>, </span>
<span>     layout <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/matrix.html" class="external-link">matrix</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">X</span>,<span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>,ncol <span class="op">=</span> <span class="fl">2</span>, nrow <span class="op">=</span> <span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-16-1.png" width="480"></p>
<p>The same network can be displayed as an OCN:</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/par.html" class="external-link">par</a></span><span class="op">(</span>mai<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span>,<span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="../reference/draw_thematic_OCN.html">draw_thematic_OCN</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span><span class="op">:</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">nNodes</span><span class="op">)</span>, <span class="va">OCNwe</span>, discreteLevels <span class="op">=</span> <span class="cn">TRUE</span>, drawNodes <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>                  colPalette <span class="op">=</span> <span class="va">rainbow</span>,  cex <span class="op">=</span> <span class="fl">3</span>, riverColor <span class="op">=</span> <span class="st">"#999999"</span>,</span>
<span>                  backgroundColor <span class="op">=</span> <span class="st">"#00000000"</span>, addLegend <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/text.html" class="external-link">text</a></span><span class="op">(</span><span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">X</span>, <span class="va">OCNwe</span><span class="op">$</span><span class="va">AG</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-17-1.png" width="480"></p>
</div>
<div class="section level3">
<h3 id="ssn">SSN<a class="anchor" aria-label="anchor" href="#ssn"></a>
</h3>
<p>Function <code>OCN_to_SSN</code> transforms an OCN at a given
aggregation level into an SSN <span class="citation">(Ver Hoef et al.
2014)</span> object. See the following example:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">ssnOCN</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/OCN_to_SSN.html">OCN_to_SSN</a></span><span class="op">(</span><span class="va">OCNwe</span>, level <span class="op">=</span> <span class="st">"RN"</span>, obsDesign <span class="op">=</span> <span class="fu">SSN</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/SSN/man/designs.html" class="external-link">binomialDesign</a></span><span class="op">(</span><span class="fl">50</span><span class="op">)</span>,</span>
<span>                     path <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html" class="external-link">paste</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/tempfile.html" class="external-link">tempdir</a></span><span class="op">(</span><span class="op">)</span>, <span class="st">"/OCN.ssn"</span>, sep <span class="op">=</span> <span class="st">""</span><span class="op">)</span>, importToR <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: shapelib support is provided by GDAL through the sf and terra</span></span>
<span><span class="co">#&gt; paackages among others</span></span>
<span></span>
<span><span class="co">#&gt; Warning: shapelib support is provided by GDAL through the sf and terra</span></span>
<span><span class="co">#&gt; paackages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: OGR support is provided by the sf and terra packages among others</span></span>
<span><span class="co">#&gt; Warning: shapelib support is provided by GDAL through the sf and terra</span></span>
<span><span class="co">#&gt; paackages among others</span></span>
<span><span class="fu">plot.SpatialStreamNetwork</span><span class="op">(</span><span class="va">ssnOCN</span>, <span class="st">"upDist"</span>, breaktype <span class="op">=</span> <span class="st">"user"</span>, brks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq</a></span><span class="op">(</span><span class="fl">0</span>,<span class="fl">14000</span>,<span class="fl">2000</span><span class="op">)</span>, </span>
<span>                          xlab <span class="op">=</span> <span class="st">"x [m]"</span>, ylab <span class="op">=</span> <span class="st">"y [m]"</span>, asp <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/title.html" class="external-link">title</a></span><span class="op">(</span><span class="st">"Distance from outlet of observation points [m]"</span><span class="op">)</span></span></code></pre></div>
<p><img src="OCNet_files/figure-html/unnamed-chunk-18-1.png" width="672"></p>
</div>
</div>
<div class="section level2">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent">
<div id="ref-campos2006" class="csl-entry">
Campos, D., J. Fort, and V. Méndez. 2006. <span>“Transport on Fractal
River Networks. Application to Migration Fronts.”</span> <em>Theoretical
Population Biology</em> 69(1): 88–93. <a href="http://dx.doi.org/10.1016/j.tpb.2005.09.001" class="external-link">http://dx.doi.org/10.1016/j.tpb.2005.09.001</a>.
</div>
<div id="ref-carrara2012" class="csl-entry">
Carrara, F., F. Altermatt, I. Rodriguez-Iturbe, and A. Rinaldo. 2012.
<span>“Dendritic Connectivity Controls Biodiversity Patterns in
Experimental Metacommunities.”</span> <em>Proceedings of the National
Academy of Sciences of the United States of America</em> 109(15):
5761–66. <a href="http://dx.doi.org/10.1073/pnas.1119651109" class="external-link">http://dx.doi.org/10.1073/pnas.1119651109</a>.
</div>
<div id="ref-carraro2020" class="csl-entry">
Carraro, L., E. Bertuzzo, E. A. Fronhofer, R. Furrer, I. Gounand, A.
Rinaldo, and F. Altermatt. 2020. <span>“Generation and Application of
River Network Analogues for Use in Ecology and Evolution.”</span>
<em>bioRxiv</em>. <a href="http://dx.doi.org/10.1101/2020.02.17.948851" class="external-link">http://dx.doi.org/10.1101/2020.02.17.948851</a>.
</div>
<div id="ref-csardi2006" class="csl-entry">
Csardi, G., and T. Nepusz. 2006. <span>“The Igraph Software Package for
Complex Network Research.”</span> <em>InterJournal</em> Complex Systems:
1695. <a href="https://igraph.org" class="external-link">https://igraph.org</a>.
</div>
<div id="ref-furrer2010" class="csl-entry">
Furrer, R., and S.R. Sain. 2010. <span>“Spam. A Sparse Matrix R Package
with Emphasis on MCMC Methods for Gaussian Markov Random Fields.”</span>
<em>Journal of Statistical Software</em> 36(10): 1–25. <a href="http://dx.doi.org/10.18637/jss.v036.i10" class="external-link">http://dx.doi.org/10.18637/jss.v036.i10</a>.
</div>
<div id="ref-gatto2013" class="csl-entry">
Gatto, M., L. Mari, E. Bertuzzo, R. Casagrandi, L. Righetto, I.
Rodriguez-Iturbe, and A. Rinaldo. 2013. <span>“Spatially Explicit
Conditions for Waterborne Pathogen Invasion.”</span> <em>American
Naturalist</em> 182(3): 328–46. <a href="http://dx.doi.org/10.1086/671258" class="external-link">http://dx.doi.org/10.1086/671258</a>.
</div>
<div id="ref-helton2018" class="csl-entry">
Helton, A.M., R.O. Hall, and E. Bertuzzo. 2018. <span>“How Network
Structure Can Affect Nitrogen Removal by Streams.”</span> <em>Freshwater
Biology</em> 63(1): 128–40. <a href="http://dx.doi.org/10.1111/fwb.12990" class="external-link">http://dx.doi.org/10.1111/fwb.12990</a>.
</div>
<div id="ref-marani1991" class="csl-entry">
Marani, A., R. Rigon, and A. Rinaldo. 1991. <span>“A Note on Fractal
Channel Networks.”</span> <em>Water Resources Research</em> 27(12):
3041–49. <a href="http://dx.doi.org/10.1029/91WR02077" class="external-link">http://dx.doi.org/10.1029/91WR02077</a>.
</div>
<div id="ref-ocallaghan1984" class="csl-entry">
O’Callaghan, J. F., and D. A. Mark. 1984. <span>“The Extraction of the
Drainage Networks from Digital Elevation Data.”</span> <em>Computer
Vision, Graphics, and Image Processing</em> 28: 323–44. <a href="http://dx.doi.org/10.1016/S0734-189X(84)80011-0" class="external-link">http://dx.doi.org/10.1016/S0734-189X(84)80011-0</a>.
</div>
<div id="ref-rinaldo2014" class="csl-entry">
Rinaldo, A., R. Rigon, J. R. Banavar, A. Maritan, and I.
Rodriguez-Iturbe. 2014. <span>“Evolution and Selection of River
Networks. Statics, Dynamics, and Complexity.”</span> <em>Proceedings of
the National Academy of Sciences of the United States of America</em>
111(7): 2417–24. <a href="http://dx.doi.org/10.1073/pnas.1322700111" class="external-link">http://dx.doi.org/10.1073/pnas.1322700111</a>.
</div>
<div id="ref-rodriguez2001" class="csl-entry">
Rodriguez-Iturbe, I., and A. Rinaldo. 2001. <em>Fractal River Basins.
Chance and Self-Organization</em>. Cambridge University Press.
</div>
<div id="ref-rodriguez1992" class="csl-entry">
Rodriguez-Iturbe, I., A. Rinaldo, R. Rigon, R. L. Bras, A. Marani, and
E. Ijjász-Vásquez. 1992. <span>“Energy Dissipation, Runoff Production,
and the Three‐dimensional Structure of River Basins.”</span> <em>Water
Resources Research</em> 28(4): 1095–1103. <a href="http://dx.doi.org/10.1029/91WR03034" class="external-link">http://dx.doi.org/10.1029/91WR03034</a>.
</div>
<div id="ref-verhoef2014" class="csl-entry">
Ver Hoef, J.M., E.E. Peterson, D. Clifford, and R. Shah. 2014.
<span>“SSN. An R Package for Spatial Statistical Modeling on Stream
Networks.”</span> <em>Journal of Statistical Software</em> 56(3): 1–45.
<a href="http://dx.doi.org/10.18637/jss.v056.i03" class="external-link">http://dx.doi.org/10.18637/jss.v056.i03</a>.
</div>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Luca Carraro, Enrico Bertuzzo.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
